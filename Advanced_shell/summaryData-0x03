#!/bin/bash

# Define the output CSV file
CSV_FILE="pokemon_report.csv"

# Start the CSV file with headers
echo "Name,Height (m),Weight (kg)" > "$CSV_FILE"

# Loop through all JSON files in the pokemon_data directory
for file in pokemon_data/*.json; do
    # Use jq to extract name, height, and weight, converting to the specified units
    if [ -f "$file" ]; then
        data=$(jq -r '[.name, .height / 10, .weight / 10]' "$file")
        
        # Read the data and remove brackets and quotes
        read -r -a values <<< "$(echo "$data" | tr -d '[],"')"
        name=${values[0]}
        height=${values[1]}
        weight=${values[2]}
        
        # Capitalize the name for proper formatting
        capitalized_name=$(echo "$name" | sed 's/./\u&/')

        # Append the data to the CSV file
        printf "%s,%s,%s\n" "$capitalized_name" "$height" "$weight" >> "$CSV_FILE"
    fi
done

echo "CSV Report generated at: $CSV_FILE"
echo "" # Empty line for formatting
cat "$CSV_FILE"

# Use awk to calculate the average height and weight
echo "" # Empty line for formatting
echo "Average Height and Weight:"
awk -F',' '
BEGIN {
    height_sum=0;
    weight_sum=0;
    count=0;
}
NR>1 {
    height_sum+=$2;
    weight_sum+=$3;
    count++;
}
END {
    if (count > 0) {
        printf "Average Height: %.2f m\n", height_sum / count;
        printf "Average Weight: %.2f kg\n", weight_sum / count;
    }
}' "$CSV_FILE"
