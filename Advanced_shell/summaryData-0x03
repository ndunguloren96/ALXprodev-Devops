#!/bin/bash

# Define the output CSV file
CSV_FILE="pokemon_report.csv"

# Start the CSV file with headers
echo "Name,Height (m),Weight (kg)" > "$CSV_FILE"

# Initialize variables for total height and weight
total_height=0
total_weight=0
count=0

# Loop through all JSON files in the pokemon_data directory
for file in pokemon_data/*.json; do
    # Use jq to extract name, height, and weight, converting to the specified units
    if [ -f "$file" ]; then
        data=$(jq -r '.name, (.height / 10), (.weight / 10)' "$file")
        
        # Read the data into variables
        read -r name height weight <<< "$data"

        # Append the data to the CSV file
        printf "%s,%s,%s\n" "$(tr '[:lower:]' '[:upper:]' <<< ${name:0:1})${name:1}" "$height" "$weight" >> "$CSV_FILE"

        # Add to the totals for average calculation
        total_height=$(echo "$total_height + $height" | bc)
        total_weight=$(echo "$total_weight + $weight" | bc)
        count=$((count + 1))
    fi
done

echo "CSV Report generated at: $CSV_FILE"
echo "" # Empty line for formatting
cat "$CSV_FILE"

# Calculate averages using awk
echo "" # Empty line for formatting
awk -F',' -v OFS=',' '
BEGIN {
    total_height=0
    total_weight=0
    count=0
}
NR>1 {
    total_height+=$2
    total_weight+=$3
    count++
}
END {
    if (count > 0) {
        printf "Average Height: %.2f m\n", total_height/count
        printf "Average Weight: %.2f kg\n", total_weight/count
    }
}' "$CSV_FILE"
